<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>聲趣 SoundKeep｜語音卡片</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .card {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      max-width: 400px;
      text-align: center;
    }

    .card audio {
      margin-top: 20px;
      width: 100%;
    }

    .card .message {
      margin-top: 20px;
      font-size: 16px;
      color: #333;
    }

    /* 額外主題樣式 */
    .theme-birthday {
      background-color: #fff0f5;
      color: #d63384;
      border: 3px dashed #f783ac;
    }

    .theme-motherday {
      background-color: #fff8f0;
      color: #e76f51;
      border: 3px solid #f4a261;
    }
    
    .theme-valentine {
      background-color: #ffe6f0;
      color: #c2185b;
      border: 3px dashed #f06292;
    }

    .theme-christmas {
      background-color: #f0fff4;
      color: #2e7d32;
      border: 3px solid #81c784;
    }
    
    }
  </style>
</head>
<body>

<div class="card" id="card">
  <h2>你的語音卡片</h2>
  <audio controls id="audioPlayer"></audio>
  <div class="message" id="messageText">載入中...</div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCZ_s-tVGQtrS3Jts_ccXWBvsg0KTRljdY",
    authDomain: "soundkeep-79219.firebaseapp.com",
    databaseURL: "https://soundkeep-79219-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "soundkeep-79219",
    storageBucket: "soundkeep-79219.firebasestorage.app",
    messagingSenderId: "239015232427",
    appId: "1:239015232427:web:9134721712ab88c4c548ee"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  const urlParams = new URLSearchParams(window.location.search);
  const cardId = urlParams.get("id");

  const audioPlayer = document.getElementById("audioPlayer");
  const messageText = document.getElementById("messageText");
  const cardDiv = document.getElementById("card");

  if (!cardId) {
    messageText.textContent = "未提供卡片 ID。";
  } else {
    const dbRef = ref(database);
    get(child(dbRef, `cards/${cardId}`)).then((snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        audioPlayer.src = data.audioURL;
        messageText.textContent = data.blessingMessage || "無祝福語";

        // 根據主題套用樣式
        const theme = data.theme || "default";
        if (theme === "birthday") {
          cardDiv.classList.add("theme-birthday");
        } else if (theme === "motherday") {
          cardDiv.classList.add("theme-motherday");
        }else if (theme === "valentine") {
          cardDiv.classList.add("theme-valentine");
        } else if (theme === "christmas") {
          cardDiv.classList.add("theme-christmas");
        }
        // default 不加 class
      } else {
        messageText.textContent = "找不到卡片資料。";
      }
    }).catch((error) => {
      console.error(error);
      messageText.textContent = "讀取卡片時發生錯誤。";
    });
  }
</script>

</body>
</html>
